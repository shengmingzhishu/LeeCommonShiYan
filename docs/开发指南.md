# 灵力检测实验室系统开发文档

## 项目概述

本项目是一个完整的灵力检测实验室系统，包含用户管理、订单管理、支付、物流、报告等核心功能。

## 技术架构

### 后端技术栈
- **开发语言**: Java 11+
- **框架**: Spring Boot 2.7.8
- **ORM**: MyBatis Plus 3.5.3
- **数据库**: MySQL 8.0
- **缓存**: Redis 6.0
- **安全**: Spring Security + JWT
- **构建**: Maven 3.6+

### 前端技术栈
- **小程序**: UniApp + Vue 3 + TypeScript
- **管理后台**: Vue 3 + TypeScript + Element Plus

## 项目结构

```
LeeCommonShiYan/
├── docs/                           # 项目文档
│   ├── 系统架构设计.md
│   ├── 数据库设计.md
│   ├── API接口设计规范.md
│   └── 项目目录结构设计.md
├── backend/                        # Java后端项目
│   ├── common/                     # 公共模块
│   ├── user-service/               # 用户服务
│   ├── auth-service/               # 认证服务
│   ├── product-service/            # 商品服务
│   ├── order-service/              # 订单服务
│   ├── payment-service/            # 支付服务
│   ├── logistics-service/          # 物流服务
│   ├── report-service/             # 报告服务
│   └── admin-service/              # 管理服务
├── frontend/                       # 前端项目
│   ├── mini-program/              # UniApp小程序
│   └── admin-web/                 # 管理后台
├── database/                       # 数据库脚本
│   ├── init/                      # 初始化脚本
│   ├── migration/                 # 数据库迁移脚本
│   └── seeds/                     # 种子数据
└── docker/                         # Docker配置
```

## 快速开始

### 1. 环境要求

- Java 11+
- MySQL 8.0+
- Redis 6.0+
- Maven 3.6+
- Git

### 2. 数据库初始化

```bash
# 进入项目根目录
cd LeeCommonShiYan

# 执行数据库初始化脚本
./database/init_db.sh dev
```

默认配置：
- 数据库主机: localhost
- 数据库端口: 3306
- 用户名: root
- 密码: root
- 数据库名: lingli_dev

### 3. 编译项目

```bash
# 进入后端目录
cd backend

# 编译所有服务
mvn clean install -DskipTests

# 单独编译某个服务
mvn clean install -DskipTests -pl user-service
```

### 4. 启动服务

```bash
# 启动用户服务
cd backend/user-service
mvn spring-boot:run

# 或者直接运行jar包
java -jar target/user-service-1.0.0.jar
```

### 5. 访问API文档

启动服务后，访问：
- Swagger UI: http://localhost:8081/api/v1/swagger-ui.html
- API文档: http://localhost:8081/api/v1/v3/api-docs

## 核心功能

### 用户认证系统

#### 注册接口
```http
POST /api/v1/auth/register
Content-Type: application/json

{
    "username": "user001",
    "password": "password123",
    "phone": "13812345678",
    "email": "user@example.com"
}
```

#### 登录接口
```http
POST /api/v1/auth/login
Content-Type: application/json

{
    "username": "user001",
    "password": "password123"
}
```

#### 刷新令牌接口
```http
POST /api/v1/auth/refresh
Content-Type: application/json

{
    "refreshToken": "refresh_token_here"
}
```

### 默认账户

系统初始化时会创建以下测试账户：

#### 超级管理员
- 用户名: root
- 密码: root123
- 角色: 城市管理员
- 说明: 系统超级管理员

#### 测试用户
- 用户名: testuser
- 密码: password123
- 角色: 普通用户

#### 管理员用户
- 用户名: bjadmin
- 密码: password123
- 角色: 公司管理员

## 开发规范

### 代码规范
- 遵循阿里巴巴Java开发手册
- 使用统一的代码格式化工具
- 关键逻辑必须有详细注释
- 单元测试覆盖率不低于80%

### API设计规范
- 遵循RESTful设计原则
- 使用统一响应格式
- 参数校验和异常处理
- JWT认证机制

### 数据库规范
- 表名使用小写字母+下划线
- 字段名使用小写字母+下划线
- 必须包含公共字段: id, created_at, updated_at, created_by, updated_by, is_deleted
- 外键约束和索引优化

## 配置文件

### 数据库配置
```yaml
spring:
  datasource:
    url: jdbc:mysql://localhost:3306/lingli_dev?useUnicode=true&characterEncoding=utf8&useSSL=true&serverTimezone=GMT%2B8
    username: root
    password: root
```

### Redis配置
```yaml
spring:
  redis:
    host: localhost
    port: 6379
    database: 0
```

### JWT配置
```yaml
jwt:
  secret: mySecretKey123456789012345678901234567890
  expiration: 7200
  refresh-expiration: 604800
```

## 测试

### 单元测试
```bash
# 运行所有测试
mvn test

# 运行特定模块测试
mvn test -pl user-service

# 生成测试报告
mvn surefire-report:report
```

### API测试
可以使用Postman或curl测试API：

```bash
# 测试登录
curl -X POST http://localhost:8081/api/v1/auth/login \
  -H "Content-Type: application/json" \
  -d '{"username":"testuser","password":"password123"}'
```

## 部署

### 本地部署
1. 确保MySQL和Redis服务正常运行
2. 执行数据库初始化脚本
3. 编译并启动服务
4. 验证服务运行状态

### Docker部署
```bash
# 启动所有服务
docker-compose up -d

# 查看服务状态
docker-compose ps

# 查看服务日志
docker-compose logs -f user-service
```

## 常见问题

### 1. 数据库连接失败
- 检查MySQL服务是否运行
- 验证数据库连接参数
- 确保数据库用户有足够权限

### 2. Redis连接失败
- 检查Redis服务是否运行
- 验证Redis连接配置
- 确保防火墙允许Redis端口访问

### 3. 端口冲突
- 修改application.yml中的端口配置
- 检查是否有其他服务占用端口

### 4. JWT令牌问题
- 检查JWT密钥配置
- 验证令牌是否过期
- 检查客户端Token传递方式

## 技术支持

如有技术问题，请：
1. 查看错误日志定位问题
2. 检查配置文件参数
3. 参考本文档常见问题
4. 联系开发团队

## 版本历史

### v1.0.0 (2023-11-28)
- 初始版本发布
- 完成基础架构搭建
- 实现用户认证系统
- 完成数据库设计
- 提供API文档